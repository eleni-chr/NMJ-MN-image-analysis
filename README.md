# NMJ-MN-image-analysis
Morphometric analysis of neuromuscular junction microscopy images, and protein distribution and localisation analysis of immunohistochemically-labelled microscopy images.

## A.	NMJ IMAGE ANALYSIS

BACKGROUND:
-	Images of neuromuscular junctions (NMJs) from fixed and immunostained tissue were acquired with a Leica SP8 confocal microscope. Immunostaining involved the use of an AChR antibody detected in the red channel and an SV2 and a 2H3 antibody detected in the green channel. All images were acquired with the same settings.

FOLDER HIERARCHY AND FILE STRUCTURE REQUIRED:
-	A folder called **z-Merge** which contains multi-frame (i.e., z-stack) RGB microscopy images in TIFF format. Each image contains a single endplate immunostained by an AChR antibody in the red channel and by an SV2 and a 2H3 antibody in the green channel. There is no staining in the blue channel. If each endplate has been cropped from a larger image, then each image may have different dimensions. The image filename must contain the mouse ID (e.g., FCD8-1).
-	A folder called **z-Endplates** which contains multi-frame (i.e., z-stack) single-channel microscopy images in TIFF format. These images correspond to the isolated red channel from the images in the **z-Merge** folder. The images have the same filename as their RGB source in the z-Merge folder.
-	A folder called **z-Terminals** which contains multi-frame (i.e., z-stack) single-channel microscopy images in TIFF format. These images correspond to the isolated green channel from the images in the **z-Merge** folder. The images have the same filename as their RGB source in the z-Merge folder.

WORKFLOW INSTRUCTIONS:
1.	Load MATLAB and set the directory to a folder which contains the subfolders **z-Endplates**, **z-Terminals**, and **z-Merge**.
2.	Run the MATLAB function **checkFrames.m** according to the instructions within the function file. This function allows you to loop through each image and define which frames need to be removed from each z-stack, in order to get rid of frames that contain overlapping axons stained by 2H3 in the green channel. Note that only consecutive frames at the start and/or end of the z-stack can be removed. The function saves an Excel file with this information, called **substackFrames.xlsx**.
a.	*Which frames to remove:*
i.	Remove frames at the start and/or end of the z-stack that contain axons, as these will interfere when trying to colocalise AChR and SV2 later.
ii.	Remove frames that correspond to two different endplates sitting on top of each other.
3.	Run the MATLAB function **makeSubstacks.m**. This function will use the information in the above **substackFrames.xlsx** file to remove the unnecessary frames from each z-stack and save the new stacks in new folders called **z-Endplates substacks**, **z-Terminals substacks**, and **z-Merge substacks**.
a.	There will be no substack images created for those endplates that have zeros in the Excel file as those are to be excluded.
4.	Load ImageJ.
5.	Run the ImageJ macro **CreateMaxProjections.ijm**. The macro will ask you to select a folder, so select the z-Endplates substacks folder. This macro will create MAX projection images for each z-stack and save these in the same subfolder.
6.	Repeat the above step for the folder **z-Terminals substacks**.
7.	Open the **z-Endplates substacks** folder. Manually move all images with “MAX” in the filename into a new folder called **Final endplates**. Do the same with the folder **z-Terminals substacks** by transferring the images to the new folder **Final terminals**.
8.	Run the ImageJ macro **Endplates_binary.ijm**. The macro will ask you to select the folder which contains the images of the individual endplates, so select the **Final endplates** folder. This macro will convert the images to binary images and save them in a subfolder called Binary endplates. The background will be black, and the endplate will be white.
9.	Look through all the binary images and if there are any that are inverted (i.e., the background is white instead of black), then transfer all the inverted binary images into a new folder and run the ImageJ macro **InvertBinaries.ijm**. The macro will ask you to select a folder so select the folder with the images to be inverted. The macro will create a subfolder with the correct binary images, so transfer those back to the folder with the remaining correct binary images and delete the folder with the inverted images.
10.	Run the ImageJ macro **ConvexHull_area.ijm**. The macro will ask you to select a folder, so select the **Binary endplates** folder. This macro will calculate the area and perimeter of the convex hull of the endplate and save the results in a CSV file called **ConvexHull_area_perim.csv** in the same folder. This macro will also create a new subfolder called **Convex hull area** with a copy of the binary images analysed, which will have an outline drawn around the endplate (this is only visible when opened in ImageJ) to show which object in the image was used for the analysis.
11.	Run the ImageJ macro **AchR_area.ijm**. The macro will ask you to select a folder, so select the **Binary endplates** folder. This macro will calculate the area and perimeter of the acetylcholine receptor staining and save the results in a CSV file called **AchR_area_perim.csv** in the same folder. This macro will also create a new subfolder called **AchR** with a copy of the binary images analysed, which will have an outline drawn around the endplate (this is only visible when opened in ImageJ) to show which object in the image was used for the analysis.
12.	Run the ImageJ macro **Endplate_fragments.ijm**. The macro will ask you to select a folder, so select the **Binary endplates** folder. This macro will calculate the number of binary objects in the image (i.e., the number of fragments that are at least 2 microns in length), and save the results in a CSV file called **Endplate_fragments.csv** in the same folder. This macro will also create a new subfolder called **Fragments** with a copy of the binary images analysed, which will have an outline drawn around each fragment identified (this is only visible when opened in ImageJ).
13.	Run the ImageJ macro **Terminal_binary.ijm**. The macro will ask you to select a folder, so select the **Final terminals** folder. This macro will convert the images to binary images and save them in a subfolder called **Binary terminals**.
14.	Look through all the binary images and if there are any that are inverted (i.e., the background is white instead of black), then transfer all the inverted binary images into a new folder and run the ImageJ macro **InvertBinaries.ijm**. The macro will ask you to select a folder so select the folder with the images to be inverted. The macro will create a subfolder with the correct binary images, so transfer those back to the folder with the remaining correct binary images and delete the folder with the inverted images.
15.	Load MATLAB and set the directory to the folder which contains the **Final terminals** and the **Final endplates** subfolders. Run the MATLAB function **terminalColocalisation.m**. This function will check which AchR pixels (red channel) colocalise with the nerve terminals (green channel) and save the binary images showing only the colocalised pixels in a new folder called **Terminal colocalisation**.
16.	Run the ImageJ macro **Terminal_area.ijm**. The macro will ask you to select a folder so select the **Terminal colocalisation** folder. This macro will calculate the area and perimeter of the colocalised area and save the results in a CSV file called **Terminal_area_perim.csv** in the same folder. This macro will also create a new subfolder called **Terminal area** with a copy of the binary images analysed, which will have an outline drawn around the endplate (this is only visible when opened in ImageJ) to show which object in the image was used for the analysis.
17.	Open the **Terminal_area_perim.csv** file. For the terminals for which the Max column shows a zero, manually change the values in the Area and Perimeter columns to zero and save the file (overwrite the original file). This is because when there is no object in the binary image, ImageJ calculates these measurements using the entire image (i.e., all the black pixels), which is wrong.
18.	Load MATLAB and set the current directory to the folder which contains the **Final terminals** and the **Final endplates** subfolders. Run the MATLAB function **compileNMJdata.m**. This function will combine the data from the following files **AChR_area_perim.csv**, **ConvexHull_area_perim**, **Endplate_fragments.csv**, and **Terminal_area_perim.csv** into a single Excel file called **NMJ_data.xlsx**. It will also calculate the additional variables Coverage and Compactness.

## B.	MOTOR NEURON IHC IMAGE ANALYSIS

BACKGROUND:
-
